////
// Автор це Богданович Давид Когут Прихожденко та Організація Мавки та Організація Організацій
////

взяти визначення МаМа;
взяти визначення мавка/розбирач;

зовнішня дія mavka_read_from_stdin(prefix: адреса<п8>): адреса<п8>;
зовнішня дія mavka_dialog(data: адреса, run: (data: адреса, value: адреса<unsigned_char>) -> ніщо);
зовнішня дія mavka_get_path_directory(path: адреса<unsigned_char>, output: адреса<адреса<unsigned_char>>): size_t;

секція мавка {
  дія прочитати_з_stdin(префікс: адреса<п8>): адреса<п8> {
    вернути mavka_read_from_stdin(префікс);
  }

  дія отримати_батьківську_директорію(шлях: адреса<unsigned_char>, вихід: адреса<адреса<unsigned_char>>): позитивне {
    вернути mavka_get_path_directory(шлях, вихід);
  }
  
  синонім памʼять = адреса;
  синонім Ю8 = памʼять<п8>;
  синонім Ю32 = памʼять<п32>;

  синонім Накопичувач = МаМа::Накопичувач;
  синонім НакопичувачЮ8 = МаМа::НакопичувачЮ8;
  синонім Реєстр = МаМа::Реєстр;
  синонім виділити = МаМа::виділити;
  синонім перевиділити = МаМа::перевиділити;
  синонім звільнити = МаМа::звільнити;

  структура Обʼєкт; // те саме що МаМа::Обʼєкт
  структура Назва;  // те саме що МаМа::Назва

  структура Результат;
  структура Помилка;
  структура Виконувач;
}

секція мавка {
  структура МісцезнаходженняПадіння {
    шлях_до_файлу: Ю8;
    рядок: позитивне;
  }

  структура ЕлементІсторіїПадіння {
    шлях_до_файлу: Ю8;
    рядок: позитивне;
    назва_дії: адреса<Назва>;
  }

  структура Падіння {
    місцезнаходження: адреса<МісцезнаходженняПадіння>;
    розмір_історії: позитивне;
    історія: памʼять<ЕлементІсторіїПадіння>;
  }

  структура Результат {
    падіння: адреса<Падіння>;
    значення: адреса<Обʼєкт>;
  }

  структура Виконувач {
    М: адреса<МаМа::Машина>;
  }
}

// Публічні дії, що можна вільно використовувати.
// Мавка намагається абстрагуватись від МаМа і надати незалежний від МаМа набір дій.
секція мавка {
  синонім НативнаДія = (обʼєкт_нативної_дії: адреса<Обʼєкт>, В: адреса<Виконувач>, обʼєкт_я: адреса<Обʼєкт>, аргументи: адреса<Накопичувач<адреса<Обʼєкт>>>, іменовані_аргументи: адреса<Реєстр<адреса<Назва>, адреса<Обʼєкт>>>) -> Результат;
  синонім ВідкликПередЗвільненнямОбʼєктаНативноїДії = (обʼєкт_нативної_дії: адреса<Обʼєкт>, В: адреса<Виконувач>) -> ніщо;

  місцева дія створити_виконувач(): адреса<Виконувач>;
  місцева дія знищити_виконувач(В: адреса<Виконувач>);
  місцева дія почати_діалог(В: адреса<Виконувач>): Результат;
  місцева дія взяти_файл(В: адреса<Виконувач>, назва_модуля: адреса<Назва>, шлях_до_файлу: Ю8): Результат;
  місцева дія виконати_ю8(В: адреса<Виконувач>, значення: Ю8): Результат;
  місцева дія зберегти_обʼєкт(В: адреса<Виконувач>, обʼєкт: адреса<Обʼєкт>);
  місцева дія видалити_збережений_обʼєкт(В: адреса<Виконувач>);
  місцева дія назва_з_Ю8(В: адреса<Виконувач>, значення: Ю8): адреса<Назва>;
  місцева дія отримати_так(В: адреса<Виконувач>): адреса<Обʼєкт>;
  місцева дія отримати_ні(В: адреса<Виконувач>): адреса<Обʼєкт>;
  місцева дія визначити_глобальний_субʼєкт(В: адреса<Виконувач>, назва: адреса<Назва>, обʼєкт: адреса<Обʼєкт>);

  місцева дія створити_нативну_дію(В: адреса<Виконувач>, назва: адреса<Назва>, значення: НативнаДія): адреса<Обʼєкт>;
  місцева дія створити_число(В: адреса<Виконувач>, значення: д64): адреса<Обʼєкт>;
  місцева дія створити_текст_з_Ю8(В: адреса<Виконувач>, значення: Ю8): адреса<Обʼєкт>;
  місцева дія створити_юнікод_з_Ю8(В: адреса<Виконувач>, значення: Ю8): адреса<Обʼєкт>;
  місцева дія створити_модуль(В: адреса<Виконувач>, назва: адреса<Назва>): адреса<Обʼєкт>;
  місцева дія створити_список(В: адреса<Виконувач>): адреса<Обʼєкт>;
  місцева дія створити_словник(В: адреса<Виконувач>): адреса<Обʼєкт>;
  місцева дія створити_обʼєкт(В: адреса<Виконувач>): адреса<Обʼєкт>;

  місцева дія обʼєкт_виконати(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>, обʼєкт_я: адреса<Обʼєкт>, аргументи: Накопичувач<адреса<Обʼєкт>>): Результат;
  місцева дія обʼєкт_отримати_властивість(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>, назва: адреса<Назва>): Результат;
  місцева дія обʼєкт_змінити_властивість(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>, назва: адреса<Назва>, значення: адреса<Обʼєкт>): Результат;
  місцева дія обʼєкт_видалити_властивість(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>, назва: адреса<Назва>): Результат;
  місцева дія обʼєкт_виконати_властивість(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>, назва: адреса<Назва>, аргументи: Накопичувач<адреса<Обʼєкт>>): Результат;
  місцева дія обʼєкт_отримати_елемент(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>, ключ: адреса<Обʼєкт>): Результат;
  місцева дія обʼєкт_змінити_елемент(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>, ключ: адреса<Обʼєкт>, значення: адреса<Обʼєкт>): Результат;
  місцева дія обʼєкт_видалити_елемент(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>, ключ: адреса<Обʼєкт>): Результат;
  місцева дія обʼєкт_отримати_перебір(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>): Результат;
  місцева дія обʼєкт_додати(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>, аргумент: адреса<Обʼєкт>): Результат;
  місцева дія обʼєкт_відняти(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>, аргумент: адреса<Обʼєкт>): Результат;
  місцева дія обʼєкт_помножити(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>, аргумент: адреса<Обʼєкт>): Результат;
  місцева дія обʼєкт_поділити(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>, аргумент: адреса<Обʼєкт>): Результат;
  місцева дія обʼєкт_остача(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>, аргумент: адреса<Обʼєкт>): Результат;
  місцева дія обʼєкт_неповна_частка(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>, аргумент: адреса<Обʼєкт>): Результат;
  місцева дія обʼєкт_степінь(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>, аргумент: адреса<Обʼєкт>): Результат;
  місцева дія обʼєкт_вліво(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>, аргумент: адреса<Обʼєкт>): Результат;
  місцева дія обʼєкт_вправо_зі_заповненням(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>, аргумент: адреса<Обʼєкт>): Результат;
  місцева дія обʼєкт_двійкове_і(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>, аргумент: адреса<Обʼєкт>): Результат;
  місцева дія обʼєкт_двійкове_або(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>, аргумент: адреса<Обʼєкт>): Результат;
  місцева дія обʼєкт_двійкове_виключне_або(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>, аргумент: адреса<Обʼєкт>): Результат;
  місцева дія обʼєкт_двійкове_не(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>): Результат;
  місцева дія обʼєкт_більше(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>, аргумент: адреса<Обʼєкт>): Результат;
  місцева дія обʼєкт_менше(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>, аргумент: адреса<Обʼєкт>): Результат;
  місцева дія обʼєкт_рівно(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>, аргумент: адреса<Обʼєкт>): Результат;
  місцева дія обʼєкт_містить(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>, аргумент: адреса<Обʼєкт>): Результат;
  місцева дія обʼєкт_є(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>, аргумент: адреса<Обʼєкт>): Результат;
  місцева дія обʼєкт_відʼємне(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>): Результат;
  місцева дія обʼєкт_числове(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>): Результат;
  місцева дія обʼєкт_заперечити(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>): Результат;
  місцева дія обʼєкт_збільшити(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>): Результат;
  місцева дія обʼєкт_зменшити(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>): Результат;

  місцева дія скомпіювати_значення_обʼєкта_юнікоду_як_Ю8(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>, адреса_на_розмір_виходу: адреса<позитивне>, адреса_на_вихід: адреса<Ю8>): логічне;

  місцева дія результат_успіх(обʼєкт: адреса<Обʼєкт>): Результат;
  місцева дія результат_падіння(обʼєкт: адреса<Обʼєкт>, місцезнаходження_падіння: адреса<МісцезнаходженняПадіння>): Результат;
  місцева дія виділити_падіння(місцезнаходження_падіння: адреса<МісцезнаходженняПадіння>, розмір_історії: позитивне, історія: памʼять<ЕлементІсторіїПадіння>): адреса<Падіння>;
  місцева дія звільнити_падіння(падіння: адреса<Падіння>);
  місцева дія виділити_місцезнаходження_падіння(шлях_до_файлу: Ю8, рядок: п32, стовпець: п32): адреса<МісцезнаходженняПадіння>;
  місцева дія звільнити_місцезнаходження_падіння(місцезнаходження_падіння: адреса<МісцезнаходженняПадіння>);
  місцева дія отримати_шлях_до_файлу_з_місцезнаходження_падіння(місцезнаходження_падіння: адреса<МісцезнаходженняПадіння>): Ю8;
  місцева дія отримати_рядок_з_місцезнаходження_падіння(місцезнаходження_падіння: адреса<МісцезнаходженняПадіння>): п32;
  місцева дія надрукувати_обʼєкт_в_накопичувач_ю8(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>, накопичувач: адреса<НакопичувачЮ8>, глибина: позитивне);
}

// Приватні дії, які не варто рухати.
секція мавка {
  структура ПомилкаКомпіляції;
  структура КонтекстКомпіляції;

  структура ПомилкаКомпіляції {
    повідомлення: Ю8;
    місцезнаходження: адреса<Місцезнаходження>;
  }

  місцева дія виділити_помилку_компіляції(): адреса<ПомилкаКомпіляції>;

  структура КонтекстКомпіляції {
    код_дії: адреса<МаМа::Код>;
  }

  місцева дія виділити_контекст_компіляції(): адреса<КонтекстКомпіляції>;
  місцева дія звільнити_контекст_компіляції(контекст: адреса<КонтекстКомпіляції>);

  місцева дія скомпілювати_елемент_значення(М: адреса<МаМа::Машина>, контекст: адреса<КонтекстКомпіляції>, код: адреса<МаМа::Код>, елемент: адреса<АСДЗначення>): адреса<ПомилкаКомпіляції>;
  місцева дія скомпілювати_тіло(М: адреса<МаМа::Машина>, контекст: адреса<КонтекстКомпіляції>, код: адреса<МаМа::Код>, тіло: адреса<СписокАСДЗначень>, вернути_в_кінці: логічне): адреса<ПомилкаКомпіляції>;
}
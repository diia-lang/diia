////
// Автор це Богданович Давид Когут Прихожденко та Організація Мавки та Організація Організацій
////

взяти визначення МаМа;
взяти визначення мавка/розбирач;

зовнішня дія mavka_read_from_stdin(prefix: Ю8): Ю8;
зовнішня дія mavka_dialog(data: адреса, run: (data: адреса, value: адреса<unsigned_char>) -> ніщо);

дія прочитати_з_stdin(префікс: Ю8): Ю8 {
  вернути mavka_read_from_stdin(префікс);
}

секція мавка {
  структура Обʼєкт; // те саме що МаМа::Обʼєкт
  структура Середовище;  // те саме що МаМа::Середовище
  структура Назва;  // те саме що МаМа::Назва
  структура МісцезнаходженняПадіння; // те саме що МаМа::МісцезнаходженняПадіння

  структура Результат;
  структура Помилка;
  структура Виконувач;
}

секція мавка {
  структура Результат {
    успіх: логічне;
    значення: адреса<Обʼєкт>;
    місцезнаходження_падіння: адреса<МісцезнаходженняПадіння>;
  }

  структура Виконувач {
    М: адреса<МаМа::Машина>;
  }
}

// Публічні дії, що можна вільно використовувати.
// Мавка намагається абстрагуватись від МаМа і надати незалежний від МаМа набір дій.
секція мавка {
  синонім НативнаДія = (обʼєкт_нативної_дії: адреса<Обʼєкт>, В: адреса<Виконувач>, обʼєкт_я: адреса<Обʼєкт>, аргументи: адреса<Накопичувач<адреса<Обʼєкт>>>, іменовані_аргументи: адреса<Реєстр<адреса<Назва>, адреса<Обʼєкт>>>) -> Результат;
  синонім ВідкликПередЗвільненнямОбʼєктаНативноїДії = (обʼєкт_нативної_дії: адреса<Обʼєкт>, В: адреса<Виконувач>) -> ніщо;

  місцева дія створити_виконувач(): адреса<Виконувач>;
  місцева дія знищити_виконувач(В: адреса<Виконувач>);
  місцева дія почати_діалог(В: адреса<Виконувач>, середовище: адреса<Середовище>): Результат;
  місцева дія взяти_файл(В: адреса<Виконувач>, назва_модуля: Ю8, шлях_до_файлу: Ю8): Результат;
  місцева дія виконати_ю8(В: адреса<Виконувач>, значення: Ю8): Результат;
  місцева дія отримати_глобальне_середовище(В: адреса<Виконувач>): адреса<Середовище>;
  місцева дія покласти_тимчасове_середовище(В: адреса<Виконувач>): адреса<Середовище>;
  місцева дія забрати_тимчасове_середовище(В: адреса<Виконувач>);
  місцева дія покласти_в_НатО(В: адреса<Виконувач>, обʼєкт: адреса<Обʼєкт>);
  місцева дія забрати_з_НатО(В: адреса<Виконувач>);
  місцева дія назва_з_ю8(В: адреса<Виконувач>, значення: Ю8): адреса<Назва>;
  місцева дія отримати_так(В: адреса<Виконувач>): адреса<Обʼєкт>;
  місцева дія отримати_ні(В: адреса<Виконувач>): адреса<Обʼєкт>;

  місцева дія створити_нативну_дію(В: адреса<Виконувач>, назва: адреса<Назва>, значення: НативнаДія): адреса<Обʼєкт>;
  місцева дія створити_число(В: адреса<Виконувач>, значення: д64): адреса<Обʼєкт>;
  місцева дія створити_текст_з_ю8(В: адреса<Виконувач>, значення: Ю8): адреса<Обʼєкт>;
  місцева дія створити_юнікод_з_ю8(В: адреса<Виконувач>, значення: Ю8): адреса<Обʼєкт>;
  місцева дія створити_модуль(В: адреса<Виконувач>, назва: адреса<Назва>): адреса<Обʼєкт>;
  місцева дія створити_список(В: адреса<Виконувач>): адреса<Обʼєкт>;
  місцева дія створити_словник(В: адреса<Виконувач>): адреса<Обʼєкт>;
  місцева дія створити_обʼєкт(В: адреса<Виконувач>): адреса<Обʼєкт>;

  місцева дія визначити(В: адреса<Виконувач>, середовище: адреса<Середовище>, назва: адреса<Назва>, обʼєкт: адреса<Обʼєкт>): Результат;
  місцева дія звернутись(В: адреса<Виконувач>, середовище: адреса<Середовище>, назва: адреса<Назва>): адреса<Обʼєкт>;
  місцева дія видалити(В: адреса<Виконувач>, середовище: адреса<Середовище>, назва: адреса<Назва>): адреса<Обʼєкт>;
  місцева дія визначити_нативну_дію(В: адреса<Виконувач>, середовище: адреса<Середовище>, назва: адреса<Назва>, значення: НативнаДія): Результат;
  місцева дія визначити_число(В: адреса<Виконувач>, середовище: адреса<Середовище>, назва: адреса<Назва>, значення: д64): Результат;
  місцева дія визначити_текст_з_ю8(В: адреса<Виконувач>, середовище: адреса<Середовище>, назва: адреса<Назва>, значення: Ю8): Результат;
  місцева дія визначити_юнікод_з_ю8(В: адреса<Виконувач>, середовище: адреса<Середовище>, назва: адреса<Назва>, значення: Ю8): Результат;
  місцева дія визначити_модуль(В: адреса<Виконувач>, середовище: адреса<Середовище>, назва: адреса<Назва>): Результат;
  місцева дія визначити_список(В: адреса<Виконувач>, середовище: адреса<Середовище>, назва: адреса<Назва>): Результат;
  місцева дія визначити_словник(В: адреса<Виконувач>, середовище: адреса<Середовище>, назва: адреса<Назва>): Результат;
  місцева дія визначити_обʼєкт(В: адреса<Виконувач>, середовище: адреса<Середовище>, назва: адреса<Назва>): Результат;

  місцева дія виконати_обʼєкт(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>, аргументи: Накопичувач<адреса<Обʼєкт>>): Результат;
  місцева дія отримати_властивість(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>, назва: Ю8): Результат;
  місцева дія змінити_властивість(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>, назва: Ю8, значення: адреса<Обʼєкт>): Результат;
  місцева дія видалити_властивість(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>, назва: Ю8): Результат;
  місцева дія виконати_властивість(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>, назва: Ю8, аргументи: Накопичувач<адреса<Обʼєкт>>): Результат;
  місцева дія отримати_елемент(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>, ключ: адреса<Обʼєкт>): Результат;
  місцева дія змінити_елемент(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>, ключ: адреса<Обʼєкт>, значення: адреса<Обʼєкт>): Результат;
  місцева дія видалити_елемент(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>, ключ: адреса<Обʼєкт>): Результат;
  місцева дія отримати_перебір(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>): Результат;
  місцева дія додати(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>, аргумент: адреса<Обʼєкт>): Результат;
  місцева дія відняти(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>, аргумент: адреса<Обʼєкт>): Результат;
  місцева дія помножити(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>, аргумент: адреса<Обʼєкт>): Результат;
  місцева дія поділити(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>, аргумент: адреса<Обʼєкт>): Результат;
  місцева дія остача(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>, аргумент: адреса<Обʼєкт>): Результат;
  місцева дія частка(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>, аргумент: адреса<Обʼєкт>): Результат;
  місцева дія степінь(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>, аргумент: адреса<Обʼєкт>): Результат;
  місцева дія вліво(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>, аргумент: адреса<Обʼєкт>): Результат;
  місцева дія вправо_зі_заповненням(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>, аргумент: адреса<Обʼєкт>): Результат;
  місцева дія двійкове_і(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>, аргумент: адреса<Обʼєкт>): Результат;
  місцева дія двійкове_або(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>, аргумент: адреса<Обʼєкт>): Результат;
  місцева дія двійкове_виключне_або(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>, аргумент: адреса<Обʼєкт>): Результат;
  місцева дія двійкове_не(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>): Результат;
  місцева дія більше(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>, аргумент: адреса<Обʼєкт>): Результат;
  місцева дія менше(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>, аргумент: адреса<Обʼєкт>): Результат;
  місцева дія рівно(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>, аргумент: адреса<Обʼєкт>): Результат;
  місцева дія містить(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>, аргумент: адреса<Обʼєкт>): Результат;
  місцева дія є(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>, аргумент: адреса<Обʼєкт>): Результат;
  місцева дія відʼємне(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>): Результат;
  місцева дія числове(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>): Результат;
  місцева дія заперечити(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>): Результат;
  місцева дія збільшити(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>): Результат;
  місцева дія зменшити(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>): Результат;

  місцева дія результат_успіх(обʼєкт: адреса<Обʼєкт>): Результат;
  місцева дія результат_падіння(обʼєкт: адреса<Обʼєкт>, місцезнаходження_падіння: адреса<МісцезнаходженняПадіння>): Результат;
  місцева дія виділити_місцезнаходження_падіння(шлях_до_файлу: Ю8, рядок: п32, стовпець: п32): адреса<МісцезнаходженняПадіння>;
  місцева дія звільнити_місцезнаходження_падіння(місцезнаходження_падіння: адреса<МісцезнаходженняПадіння>);
  місцева дія отримати_шлях_до_файлу_з_місцезнаходження_падіння(місцезнаходження_падіння: адреса<МісцезнаходженняПадіння>): Ю8;
  місцева дія отримати_рядок_з_місцезнаходження_падіння(місцезнаходження_падіння: адреса<МісцезнаходженняПадіння>): п32;
  місцева дія отримати_стовпець_з_місцезнаходження_падіння(місцезнаходження_падіння: адреса<МісцезнаходженняПадіння>): п32;
  місцева дія надрукувати_обʼєкт_в_накопичувач_ю8(обʼєкт: адреса<Обʼєкт>, В: адреса<Виконувач>, накопичувач: адреса<НакопичувачЮ8>, глибина: позитивне);
}

// Приватні дії, які не варто рухати.
секція мавка {
  структура ПомилкаКомпіляції;
  структура КонтекстКомпіляції;

  структура ПомилкаКомпіляції {
    повідомлення: Ю8;
    місцезнаходження: адреса<Місцезнаходження>;
  }

  місцева дія виділити_помилку_компіляції(): адреса<ПомилкаКомпіляції>;

  структура КонтекстКомпіляції {
    код_дії: адреса<МаМа::Код>;
  }

  місцева дія виділити_контекст_компіляції(): адреса<КонтекстКомпіляції>;
  місцева дія звільнити_контекст_компіляції(контекст: адреса<КонтекстКомпіляції>);

  місцева дія скомпілювати_елемент_значення(М: адреса<МаМа::Машина>, контекст: адреса<КонтекстКомпіляції>, код: адреса<МаМа::Код>, елемент: адреса<АСДЗначення>): адреса<ПомилкаКомпіляції>;
  місцева дія скомпілювати_тіло(М: адреса<МаМа::Машина>, контекст: адреса<КонтекстКомпіляції>, код: адреса<МаМа::Код>, тіло: адреса<СписокАСДЗначень>, вернути_в_кінці: логічне): адреса<ПомилкаКомпіляції>;
}